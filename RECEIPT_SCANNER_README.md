# 📸 פיצ'ר סריקת חשבוניות

## 🎯 סקירה כללית

פיצ'ר חדשני המאפשר לסרוק חשבוניות ולחלץ אוטומטית:
- תאריך החשבונית
- סכום כולל
- שם העסק
- זיהוי אוטומטי של קטגוריה
- רשימת פריטים (אופציונלי)

## 🚀 איך זה עובד?

### 1. **גישה לסריקה**
בעת הוספת תנועה חדשה, לחץ על כפתור **"📸 סרוק חשבונית"**

### 2. **העלאת תמונה**
שלוש דרכים להעלות חשבונית:
- **גרירה** - גרור תמונה לאזור ההעלאה
- **לחיצה** - לחץ על האזור ובחר תמונה מהמחשב
- **צילום** - לחץ על "צלם חשבונית" כדי לצלם ישירות מהמצלמה

### 3. **סריקה אוטומטית**
המערכת תסרוק את החשבונית ותחלץ:
- ✅ תאריך
- ✅ סכום
- ✅ שם העסק
- ✅ קטגוריה מתאימה

### 4. **אישור והשלמה**
- בדוק את הנתונים שנסרקו
- השלם או תקן ידנית אם נדרש
- לחץ **"השתמש בנתונים"** למילוי אוטומטי של הטופס

## 🔧 הגדרות טכניות

### גרסה בסיסית (ללא Google Cloud Vision)
הגרסה הנוכחית מבצעת ניתוח בסיסי של טקסט.

### שדרוג ל-Google Cloud Vision API

אם אתה רוצה דיוק גבוה יותר, הפעל את Google Cloud Vision API:

#### שלב 1: הגדרת Google Cloud
1. צור פרויקט ב-[Google Cloud Console](https://console.cloud.google.com/)
2. הפעל את Vision API
3. צור Service Account וקבל JSON key file
4. הורד את ה-JSON key

#### שלב 2: הגדרת המפתח
```bash
# הגדר את המשתנה סביבתית
export GOOGLE_APPLICATION_CREDENTIALS="/path/to/your/key.json"

# או הוסף ל-.env:
echo "GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/key.json" >> server/.env
```

#### שלב 3: הסרת הערות בקוד
ב-`server/src/utils/receiptScanner.js` הסר את ההערות:

```javascript
// הסר הערה מהשורה הזו:
import vision from '@google-cloud/vision';

// והסר הערה מהקוד:
const client = new vision.ImageAnnotatorClient();
const [result] = await client.textDetection(imageBuffer);
// ...
```

## 📊 זיהוי קטגוריות

המערכת מזהה אוטומטית קטגוריות לפי שם העסק:

| קטגוריה | דוגמאות לעסקים |
|----------|----------------|
| **מזון** | רמי לוי, שופרסל, מגה, ויקטורי, טיב טעם |
| **תחבורה** | דלק, סונול, פז, דור אלון |
| **אוכל בחוץ** | מסעדה, קפה קפה, ארומה, מקדונלד |
| **בילויים** | קולנוע, yes פלאנט, סינמה סיטי |
| **בריאות** | סופר פארם, ניו פארם, בית מרקחת |
| **ביגוד** | זארה, H&M, קסטרו, פוקס |
| **חשבונות** | חשמל, מים, בזק, סלקום |

## 💡 טיפים לסריקה טובה

### תמונה איכותית
- ✅ תאורה טובה
- ✅ חשבונית ישרה (לא מקופלת)
- ✅ טקסט ברור וקריא
- ✅ חשבונית שלמה (כל הפרטים בתמונה)

### להימנע מ:
- ❌ תאורה חלשה או צללים
- ❌ חשבונית מקומטת או קרועה
- ❌ טקסט מטושטש
- ❌ חיתוך של פרטים חשובים

## 📱 פורמטים נתמכים

- **JPEG / JPG**
- **PNG**
- **HEIC** (iOS)

**מקסימום**: 10MB

## 🔒 אבטחה ופרטיות

- כל החשבוניות נשמרות **מקומית בשרת** שלך
- אף אחד חוץ ממך לא רואה את החשבוניות
- החשבוניות מקושרות למשק הבית שלך בלבד
- ניתן למחוק חשבוניות בכל עת

## 🗂️ היסטוריית חשבוניות (עתידי)

בקרוב תוכל:
- לצפות בכל החשבוניות שסרקת
- לחפש לפי תאריך / סכום / עסק
- לקשר חשבונית לתנועה קיימת
- להוריד חשבוניות

## 🐛 בעיות נפוצות

### "לא זוהה טקסט בתמונה"
- בדוק שהתמונה ברורה וקריאה
- נסה לצלם מזווית אחרת עם תאורה טובה יותר

### "הסכום לא נכון"
- המערכת מנסה למצוא את הסכום הגבוה ביותר
- תמיד כדאי לבדוק ולתקן ידנית אם נדרש

### "הקטגוריה לא מתאימה"
- ניתן לשנות ידנית את הקטגוריה לפני שמירת התנועה
- המערכת לומדת מהעסקים הנפוצים בישראל

## 🎓 למפתחים

### API Endpoints

```javascript
// סריקת חשבונית
POST /api/receipts/scan
Content-Type: multipart/form-data
Body: { receipt: <file> }

// קבלת כל החשבוניות
GET /api/receipts

// קבלת חשבונית ספציפית
GET /api/receipts/:id

// מחיקת חשבונית
DELETE /api/receipts/:id
```

### מבנה התשובה

```json
{
  "receiptId": "64f5a...",
  "date": "2025-10-13T00:00:00.000Z",
  "total": 150.50,
  "businessName": "סופרמרקט רמי לוי",
  "category": "מזון",
  "subcategory": "סופרמרקט",
  "items": [
    { "name": "חלב", "price": 5.90 },
    { "name": "לחם", "price": 7.50 }
  ],
  "imageUrl": "/uploads/receipts/receipt-1234567890.jpg",
  "confidence": 0.85,
  "rawText": "..."
}
```

## 📈 סטטיסטיקות

מדד הדיוק:
- **גבוה (80-100%)**: תאריך, סכום, שם עסק
- **בינוני (50-80%)**: קטגוריה, פריטים
- **נמוך (<50%)**: תתי-קטגוריה, כמויות

## 🔮 תוספות עתידיות

- [ ] OCR משופר עם Tesseract.js
- [ ] למידת מכונה לשיפור זיהוי קטגוריות
- [ ] זיהוי אוטומטי של מבצעים והנחות
- [ ] סריקה של חשבוניות דיגיטליות (PDF)
- [ ] ייבוא אוטומטי מאפליקציות בנק
- [ ] תמיכה בשפות נוספות

---

**נהנית מהפיצ'ר? תן לנו ⭐ ב-GitHub!**

